name: Sync dify images to ACR(Alibaba Cloud Container Registry)

on:
  schedule:
    - cron: '0 */4 * * *'
  workflow_dispatch:

env:
  ACR_REGISTRY: registry.cn-hangzhou.aliyuncs.com

jobs:
  pull-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Login to the ACR
        uses: docker/login-action@v2
        with:
          registry: ${{ env.ACR_REGISTRY }}
          username: ${{ secrets.ACR_USERNAME }}
          password: ${{ secrets.ACR_PASSWORD }}

      - name: Pull confluence-server image from Docker Hub
        run: docker pull atlassian/confluence-server:6.15.2

      - name: Tag confluence-server image for ACR
        run: docker tag atlassian/confluence-server:6.15.2 ${{ env.ACR_REGISTRY }}/${{ secrets.ACR_NAMESPACE }}/confluence-server:6.15.2

      - name: Push confluence-server image to Aliyun Registry
        run: docker push ${{ env.ACR_REGISTRY }}/${{ secrets.ACR_NAMESPACE }}/confluence-server:6.15.2

      - name: Pull atlassian-jira-software image from Docker Hub
        run: docker pull cptactionhank/atlassian-jira-software:8.0.2

      - name: Tag atlassian-jira-software image for ACR
        run: docker tag cptactionhank/atlassian-jira-software:8.0.2 ${{ env.ACR_REGISTRY }}/${{ secrets.ACR_NAMESPACE }}/atlassian-jira-software:8.0.2

      - name: Push atlassian-jira-software image to Aliyun Registry
        run: docker push ${{ env.ACR_REGISTRY }}/${{ secrets.ACR_NAMESPACE }}/atlassian-jira-software:8.0.2

      - name: Pull mysql-server image from Docker Hub
        run: docker pull mysql/mysql-server:5.7

      - name: Tag mysql-server image for ACR
        run: docker tag mysql/mysql-server:5.7 ${{ env.ACR_REGISTRY }}/${{ secrets.ACR_NAMESPACE }}/mysql-server:5.7

      - name: Push mysql-server image to Aliyun Registry
        run: docker push ${{ env.ACR_REGISTRY }}/${{ secrets.ACR_NAMESPACE }}/mysql-server:5.7
